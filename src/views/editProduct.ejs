<!DOCTYPE html>
<html lang="en">

<%- include('partials/head') %>

  <body>
    <%- include('partials/headerNavbar') %>
      <main>
        <h1 class="h1-registrarte">Crear producto</h1>
        <div class="contenedor-padre">
          <form action="/registrarte" class="formulario" id="formulario" method="POST" enctype="multipart/form-data">

            <!--  name -->
            <div class="formulario__grupo" id="grupo__name">
              <label for="name" class="formulario__label">NOMBRE DEL PRODUCTO</label>
              <div class="formulario__grupo-input">
                <input type="text" class="formulario__input" name="name" id="name" placeholder="Pepito">
                <i class="formulario__validacion-estado fas fa-times-circle"></i>
              </div>
              <p class="formulario__input-error">El Nombre tiene que ser de 4 a 16 dígitos y solo puede contener
                letras.</p>
              <% if (locals.errors && errors.name) {%>
                <%= errors.name.msg %>
                  <%}%>
            </div>

            <!--  price -->
            <div class="formulario__grupo" id="grupo__price">
              <label for="price" class="formulario__label">PRECIO DEL PRODUCTO</label>
              <div class="formulario__grupo-input">
                <input type="text" class="formulario__input" name="price" id="price" placeholder="Elpistolero">
                <i class="formulario__validacion-estado fas fa-times-circle"></i>
              </div>
              <% if (locals.errors && errors.price) {%>
                <%= errors.price.msg %>
                  <%}%>
                    <p class="formulario__input-error">El Apellido tiene que ser de 4 a 16 dígitos y solo puede contener
                      letras.</p>
            </div>
          
            <!-- Categoria  -->
            <p class="category-edit">
              <label for="category" class="form-label">Categoría:</label>
              <select name="category" id="category" class="category-edit">
                  <option value="">Elegí</option>
                  <option value="1">Texanas</option>
                  <option value="3">Borcegos</option>
                  <option value="2">Botas</option>
                  <option value="4">Zapatillas</option>
              </select>
          </p>

            <!--  Descuento -->
            <div class="formulario__grupo" id="grupo__discount">
              <label for="discount" class="formulario__label">DESCUENTO</label>
              <div class="formulario__grupo-input">
                <input type="text" class="formulario__input" name="discount" id="discount" placeholder="4491234567">
                <i class="formulario__validacion-estado fas fa-times-circle"></i>
              </div>
              <% if (locals.errors && errors.discount) {%>
                <%= errors.discount.msg %>
                  <%}%>
                    <p class="formulario__input-error">El discount solo puede contener numeros y el maximo son 14 dígitos.
                    </p>
            </div>

            <p class="foto-edit">
              <label>Foto del producto:</label>
              <input type="file" value="<%= product.image %>" required name="fotoProducto">
          </p>
          <div>

      
            <div class="formulario__mensaje" id="formulario__mensaje">
              <p><i class="fas fa-exclamation-triangle"></i> <b>Error:</b> Por favor rellena el formulario
                correctamente. </p>
            </div>

            <div class="formulario__grupo formulario__grupo-btn-enviar">
              <button type="submit" class="formulario__btn">Enviar</button>
              <p class="formulario__mensaje-exito" id="formulario__mensaje-exito">Formulario enviado exitosamente!</p>
            </div>
          </form>
        </div>
      </main>

      <script>
        const formulario = document.getElementById('formulario');
        const inputs = document.querySelectorAll('#formulario input');

        const expresiones = {
          name: /^[a-zA-ZÀ-ÿ\s]{2,40}$/, // Letras y espacios, pueden llevar acentos.
          price: /^[a-zA-Z0-9\_\-]{4,16}$/, // Letras, numeros, guion y guion_bajo
          password: /^.{8,12}$/, // 4 a 12 digitos.
          email: /^[a-zA-Z0-9_.+-]+@[a-zA-Z0-9-]+\.[a-zA-Z0-9-.]+$/,
          discount: /^\d{7,14}$/ // 7 a 14 numeros.
        }

        const campos = {
          price: false,
          name: false,
          password: false,
          email: false,
          discount: false
        }

        const validarFormulario = (e) => {
          switch (e.target.name) {
            case "name":
              validarCampo(expresiones.name, e.target, 'name');
              break;
            case "price":
              validarCampo(expresiones.price, e.target, 'price');
              break;
            case "password":
              validarCampo(expresiones.password, e.target, 'password');
              validarPassword2();
              break;
            case "password2":
              validarPassword2();
              break;
            case "email":
              validarCampo(expresiones.email, e.target, 'email');
              break;
            case "discount":
              validarCampo(expresiones.discount, e.target, 'discount');
              break;
          }
        }

        const validarCampo = (expresion, input, campo) => {
          if (expresion.test(input.value)) {
            document.getElementById(`grupo__${campo}`).classList.remove('formulario__grupo-incorrecto');
            document.getElementById(`grupo__${campo}`).classList.add('formulario__grupo-correcto');
            document.querySelector(`#grupo__${campo} i`).classList.add('fa-check-circle');
            document.querySelector(`#grupo__${campo} i`).classList.remove('fa-times-circle');
            document.querySelector(`#grupo__${campo} .formulario__input-error`).classList.remove('formulario__input-error-activo');
            campos[campo] = true;
          } else {
            document.getElementById(`grupo__${campo}`).classList.add('formulario__grupo-incorrecto');
            document.getElementById(`grupo__${campo}`).classList.remove('formulario__grupo-correcto');
            document.querySelector(`#grupo__${campo} i`).classList.add('fa-times-circle');
            document.querySelector(`#grupo__${campo} i`).classList.remove('fa-check-circle');
            document.querySelector(`#grupo__${campo} .formulario__input-error`).classList.add('formulario__input-error-activo');
            campos[campo] = false;
          }
        }

        const validarPassword2 = () => {
          const inputPassword1 = document.getElementById('password');
          const inputPassword2 = document.getElementById('password2');

          if (inputPassword1.value !== inputPassword2.value) {
            document.getElementById(`grupo__password2`).classList.add('formulario__grupo-incorrecto');
            document.getElementById(`grupo__password2`).classList.remove('formulario__grupo-correcto');
            document.querySelector(`#grupo__password2 i`).classList.add('fa-times-circle');
            document.querySelector(`#grupo__password2 i`).classList.remove('fa-check-circle');
            document.querySelector(`#grupo__password2 .formulario__input-error`).classList.add('formulario__input-error-activo');
            campos['password'] = false;
          } else {
            document.getElementById(`grupo__password2`).classList.remove('formulario__grupo-incorrecto');
            document.getElementById(`grupo__password2`).classList.add('formulario__grupo-correcto');
            document.querySelector(`#grupo__password2 i`).classList.remove('fa-times-circle');
            document.querySelector(`#grupo__password2 i`).classList.add('fa-check-circle');
            document.querySelector(`#grupo__password2 .formulario__input-error`).classList.remove('formulario__input-error-activo');
            campos['password'] = true;
          }
        }

        inputs.forEach((input) => {
          input.addEventListener('keyup', validarFormulario);
          input.addEventListener('blur', validarFormulario);
        });

        formulario.addEventListener('submit', (e) => {
          e.preventDefault();

          const terminos = document.getElementById('terminos');
          if (campos.price && campos.name && campos.password && campos.email && campos.discount && terminos.checked) {
            formulario.submit();


            document.getElementById('formulario__mensaje-exito').classList.add('formulario__mensaje-exito-activo');
            setTimeout(() => {
              document.getElementById('formulario__mensaje-exito').classList.remove('formulario__mensaje-exito-activo');
            }, 5000);

            document.querySelectorAll('.formulario__grupo-correcto').forEach((icono) => {
              icono.classList.remove('formulario__grupo-correcto');
            });
          } else {
            document.getElementById('formulario__mensaje').classList.add('formulario__mensaje-activo');
          }
        });

      </script>



  </body>

</html>